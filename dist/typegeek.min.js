define(["src/dicts/grc"],function(a){"use strict";function b(b){return this.el="string"==typeof b?document.querySelector(b):b,this.dict=a,this.render(),this.el.addEventListener("keydown",this.handleKeypress.bind(this)),this}return b.prototype.render=function(){this.container=document.createElement("div"),this.container.className="typegeek",this.menu=document.createElement("ul"),this.insertAfter(this.container,this.el),this.container.appendChild(this.el),this.container.appendChild(this.menu)},b.prototype.renderKeys=function(a){this.menu.innerHTML="",0!==a.length&&Object.keys(a.options).forEach(function(b){var c=document.createElement("li"),d=document.createElement("a");d.setAttribute("href","#");var e=a.options[b];d.innerHTML="object"==typeof e?b:a.options[b]+"<span>"+b+"</span>",d.setAttribute("data-keycode",this.getKeyByValue(this.dict.keyCodes,b)),d.addEventListener("click",this.handleKeypress.bind(this)),c.appendChild(d),this.menu.appendChild(c)}.bind(this))},b.prototype.keyMap=[],b.prototype.handleKeypress=function(a){var b=a.keyCode||a.target.dataset.keycode;if(27===b)return void this.clearUI();var c=this.dict.keyCodes[b];if(c){var d=-1!==this.keyMap.indexOf(c);if(d?this.keyMap.splice(this.keyMap.indexOf(c),1):this.keyMap.push(c),0===this.keyMap.length)return a.preventDefault(),void this.clearUI();var e=this.convert(this.keyMap,0,this.dict.dictionary);return e?(a.preventDefault(),e.options?void this.renderKeys(e):(this.el.value=this.el.value?this.el.value+=e:e,this.clearUI(),!1)):(a.preventDefault(),void this.clearUI())}},b.prototype.clearUI=function(){this.keyMap=[],this.renderKeys([])},b.prototype.convert=function(a,b,c){var d=a[b],e=a.length-1===b,f=c[d];return b++,f?f.options&&!e?this.convert(a,b,f.options):f:void 0},b.prototype.showOptions=function(a){var b=Object.keys(a.options).map(function(b){return"object"==typeof a.options[b]?b:a.options[b]});return b},b.prototype.insertAfter=function(a,b){b.parentNode.insertBefore(a,b.nextSibling)},b.prototype.getKeyByValue=function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&a[c]===b)return c},b});